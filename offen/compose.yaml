services:
  offen:
    image: offen/docker-volume-backup:v2.47.0
    container_name: offen
    restart: always
    env_file: ./.env
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          memory: 128M
    healthcheck:
      test: ["CMD-SHELL", "pgrep crond || exit 1"]
      interval: 1m
      timeout: 10s
      retries: 3
    volumes:
      # --- Tailscale ---
      - ../tailscale/data:/backup/tailscale/data:ro
      - ../tailscale/.env:/backup/tailscale/.env:ro

      # --- Traefik ---
      - ../traefik/data:/backup/traefik/data:ro
      - ../traefik/.env:/backup/traefik/.env:ro

      # --- AdGuard Home ---
      - ../adguardhome/data:/backup/adguardhome/data:ro
      - ../adguardhome/.env:/backup/adguardhome/.env:ro

      # --- Vaultwarden ---
      - ../vaultwarden/data:/backup/vaultwarden/data:ro
      - ../vaultwarden/.env:/backup/vaultwarden/.env:ro

      # --- Radicale ---
      - ../radicale/data:/backup/radicale/data:ro
      - ../radicale/.env:/backup/radicale/.env:ro

      # --- Offen ---
      - ./.env:/backup/offen/.env:ro

      - ./data/archive:/archive
      - /var/run/docker.sock:/var/run/docker.sock:ro
